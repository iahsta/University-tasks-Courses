---
title: "Лабораторная работа. Коэффициент автономности"
author: "Dibirova Aishat"
date: "14 04 2020"
output:
  word_document: default
  pdf_document: default
  html_document:
    df_print: paged
---
#1.Статистическое оценивание
## Коэффициент автономности для 100 предприятий города

```{r, fig.cap= "*Рис.1 Гистограмма, ящичковая диаграмма и кумулята исследуемой переменной, выдаваемые функцией*`Desc`"}
getwd()
setwd("C:/Users/bydag/Desktop/R")
library("rio")
dataframe <- import("Данные по вариантам для выполнения типового расчета (1).xlsx")
data <- dataframe["v6"]
head(data)
tail(data)
str(data)
data <- data[1:100,]
data <- as.data.frame(as.numeric(data))
names(data) <- "Коэффициенты автономности для 100 предприятий"
summary(data)
library("DescTools")
Desc(data)
volume <- data[[1]]
n <- length(volume)


```




```{r, fig.cap = "*Рис.2 Гистограмма эмпирических частот коэффициентов автономности, построенная с помощью базовой функции*`hist`"}

hist = hist(volume, freq = TRUE, col = "blue",
            breaks = "sturges",
            xlab = "Нижняя граница интервала",
            ylab = "Частота",
            ylim = c(0, 30),
            main = "Гистограмма эмпирических частот")
```



```{r, fig.cap = "*Рис.3 Гистограмма эмпирических частот коэффициентов автономности и теоретическая кривая Гаусса, построенные с помощью базовой функции*`hist`"}

hist = hist(volume, freq = TRUE, col = "blue",
            breaks = "sturges",
            xlab = "Нижняя граница интервала",
            ylab = "Частота",
            ylim = c(0, 30),
            main = "Гистограмма эмпирических частот")
x_values <- seq(from = min(volume) - 0.01,to = max(volume) + 0.01, length = 1000)
h = unlist(hist["breaks"])[2] - unlist(hist["breaks"])[1]
y_values <- dnorm(x_values, mean = mean(volume), sd = sd(volume))*h*n
lines(x_values, y_values, col = "green")

```


```{r}
library("DescTools")
gamma = 0.99
MeanCI(volume, conf.level = gamma)
VarCI(volume, conf.level = gamma, method = "norm")
sdCI <- c(sd(volume)*sqrt(2*n)/(sqrt(2*n - 3) + qnorm(1 - (1 - gamma)/2)),
sd(volume)*sqrt(2*n)/(sqrt(2*n - 3) - qnorm(1 - (1 - gamma)/2)))
names(sdCI) <- c('sd_min', 'sd_max')
sdCI


```
Тогда при неизвестной генеральной дисперсии интервальная оценка генеральной средней:
$$P(0.3989  \le \mu  \le 0.4873) = 0.99$$
Доверительный интервал для дисперсии с надежностью 0,99 задается как:
$$P(0.01889 \le \sigma \le 0.03805) = 0.99$$

## Задание 1.7 (номер задачи из ДКР1 3.111)

Для большого объема выборки ($n=100$):
```{r}
n2 = 100
m2 = 9
gamma = 0.899
BinomCI(m2, n2, conf.level = gamma, method = 'wald')
BinomCI(m2, n2, conf.level = gamma, method = 'agresti-coull')

```
Для малого объема выбоки ($n=10$):

```{r}
n1 = 10
m1 = 1
gamma = 0.899
BinomCI(m1, n1, conf.level = gamma, method = 'clopper-pearson')
BinomCI(m1, n1, conf.level = gamma, method = 'wilson')
BinomCI(m1, n1, conf.level = gamma, method = 'jeffreys')

```

# 2.Проверка гипотез
## 2.1 Тесты на однородность дисперсий независимых выборок

```{r}
alpha <- 0.05
X <- volume[1:50]
Y <- volume[51:100]
var.test(X, Y)
qf(alpha, 49, 49, lower.tail = FALSE)
LeveneTest(X, Y, data = volume)


```
Так как p-value меньше, чем 0,05, то то нулевая гипотеза о равенстве двух дисперсий  отвергается.
Однако в то же время F критическое (1,6) > F наблюдаемое (0,496), что говорит о том, что гипотеза, наоборот, не отвергается. Возможно, это противоречие вызвано тем, что наши данные не подчиняются нормальному распределению, поэтому проверим гипотезу о равенстве дисперсий с помощью теста Левене. По нему выходит, что $p-value = 0.5542$, что больше $alpha = 0.05$, а F критическое (1,6) > F наблюдаемое (0,9175), соответствено, гипотеза не отвергается. 


## 2.2 Тесты на равенство средних
### 2.2.1 Сравнение среднего совокупности с заданным значением - параметрический тест (t-тест Стьюдента)
Допустим, среднее значение коэффициента автономности должно составлять $0,45$.

```{r}
t.test(X, mu = 0.45)
qt(alpha/2, 49)
```
Так как значение $p-value = 0,2667$, что больше $alpha = 0,05$, гипотеза не отвергается на уровне значимости $0,05$. Наблюдаемое значение статистики критерия: $t = -1.12$, что по модулю меньше, чем $t-критическое = 2,0096$. Доверительный интервал для генеральной средней содержит значение норматива = 0,45: $$P(0.3892 < \mu < 0.4672)=0,95$$
Таким образом, можем сделать вывод о том, что гипотеза $H0: mu = 0,45$ не отвергается на уровне значимости $alpha=0,05$.


### 2.2.2 Сравнение среднего выборки с заданным значением - непараметрический тест Вилкоксона

```{r}
wilcox.test(X, mu = 0.45)

```
Поскольку $p-value=0,074$, что больше $alpha=0,05$, гипотеза о равенстве средней 0,45 не отвергается на уровне значимости $alpha=0,05$.


### 2.2.3 Сравнение средних двух независимых нормально распределенных совокупностей -параметрический тест (t-тест Стьюдента)

```{r}
t.test(X, Y, var.equal = TRUE, paired = FALSE)
qt(0.975, 98)

```
Видим, что $p-value=0,3786$, что, несомненно, больше, чем $alpha=0,05$, следовательно, гипотеза о равенстве двух средних не отвергается на уровне значимости 0,05. 
Также получаем $t-критическое=1.984$, которое по модулю превышает $t-наблюдаемое=0,884$, что свидетельствует о том, что гипотза о равенстве двух средних не отвергается на уровне значимости 0,05. 


```{r, fig.cap = "*Рис.4 Ящичковые диаграммы (boxplots) для переменных Х и У, построенные с помощью функции ggboxplot пакета*`ggpubr`"}
#Создаем таблицу данных из двух столбцов
my_data <- data.frame(group = rep(c("X", "Y"), each = 50), something = c(X, Y))
print(my_data)
library("ggpubr")
ggboxplot(my_data, x = "group", y = "something",
color = "group", palette = c("#00AFBB", "#E7B800"),
ylab = "something", xlab = "Groups")
```

## 2.3 Критерии проверки параметров биномиальных распределений 
### 2.3.1. Тест на равенство вероятности успеха в испытании Бернулли определенной константе (№5.111 из ДКР2)
a) $n=400$; $m=5$; $alpha=0,05$
$H0: p=p0$
$H1: p\neq p0$
```{r}
prop.test(5, 400, p = 0.005, alternative = c("two.sided"))
prop.test(5, 400, p = 0.005, alternative = c("two.sided"), correct = FALSE)
binom.test(5, 400, p = 0.005)
```
Поскольку у нас выборка достаточно большая $n=400$, мы в первую очередь использовали функцию `prop.test`, получилось, что $p-value=0,07$ , больше чем $alpha=0,05$. Используя `binom.test`, также получаем, что $p-value=0,0522$ немного больше $alpa=0,05$. Однако результат с поправкой Йетса показал обратное: $p-value=0,3345<alpha=0,05$, следовательно, гипотеза $H0$ отвергается на уровне значимости $alpha=0,05$. 
б)$n=400$; $m=5$; $alpha=0,05$
$H0: p=p0$
$H1: p>p0$
```{r}
prop.test(5, 400, p = 0.005, alternative = c("greater"))
prop.test(5, 400, p = 0.005, alternative = c("greater"), correct = FALSE)
```
В случае с левосторонней критической областью и с поправкой Йетса, и без нее p-value меньше, чем alpha (из чего следует, что $H0: p=p0$ отвергается на уровне значимости $alpha=0,05$):
$$p-value=0,038<0,05$$
$$p-value=0,017<0,05$$
### 2.3.2 Тест на равенство вероятностей успеха в испытаниях Бернулли для нескольких биномиально распределенных совокупностей
в)$n1=400$; $m1=5$; $n2=300$; $m2=3$; $alpha=0,05$
$H0: p1=p2$
$H1: p1<p2$
```{r}
prop.test(x = c(5, 3), n = c(400, 300), correct = FALSE)
qchisq(0.95, 1)

```
Видим, что $хи-квадрат набл.=0,095<хи-квадрат крит.=3,841$, а также $p-value=0,76$, что больше $alpha=0,05$, следовательно, нулевая гипотеза о равенстве вероятностей успеха не отвергается на уровне значимости $alpha=0,05$.


## 2.4 Критерии согласия эмпирического распределения с теоретическим
### 2.4.1 Визуализация данных с целью подбора наилучшего теоретического распределения

```{r, fig.cap = "*Рис.5 Эмпирическая плотность распределения коэффициентов автономности, построенная с помощью функции `ggdensity` пакета `ggpubr`*"}
library("ggpubr")
ggdensity(volume, main = "Эмпирическая плотность коэффициентов автономности", xlab = "Коэффициенты автономности ста предприятий")
```

```{r, fig.cap = "*Рис.6 Квантильный график - эмпирическое распределение квантилей коэффициентов автономности и квантилей нормального распределения, построенный с помощью функции `ggdensity` пакета `ggpubr`*"}
ggqqplot(volume)
```
вывод:

Теперь рассмотрим гипотезу о нормальным распределении коэффициентов автономности для ста предприятий. Для начала сделаем это спомощью теста Андерсона-Дарлинга:
```{r}
Sys.getenv("C:/Program Files/R/R-3.6.3/library")
.libPaths()
install.packages("nortest")
library(nortest)
ad.test(volume)
```
Получаем, что $p-value=0,08419$, что больше $alpha=0,05$, следовательно, гипотеза о нормальном законе распределения коэффициентов автономности ста предприятий не отвергается на уровне значимости $alpha=0,05$.

Далее обратимся к тесту Лиллиефорса:
```{r}
lillie.test(volume)
```
Тест Лиллиефорса дает совершенно отличный от теста Андерсона-Дарлинга результат: $p-value=0,01721<0,05$. Согласно этому тесту, гипотеза о нормальном распределении отвергается на уровне значимости $alpha=0,05$.

```{r}
chisq.test(volume, simulate.p.value = TRUE, B = 2000)
```












